<!doctype html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

  <title>Search the Docs</title>

  <link rel="stylesheet" href="dist/reset.css">
  <link rel="stylesheet" href="dist/reveal.css">
  <link rel="stylesheet" href="dist/theme/white.css" id="theme">

  <!-- Theme used for syntax highlighted code -->
  <link rel="stylesheet" href="plugin/highlight/github-gist.css" id="highlight-theme">

  <!-- Fontawesome -->
  <link rel="stylesheet" href="plugin/fontawesome/css/all.css">

  <style type="text/css" media="screen">
    .red {
      color: red;
    }

    .green {
      color: green;
    }

    .blue {
      color: #3e7bac;
    }

    .orange {
      color: orange;
    }

    .gray {
      color: #888;
    }
  </style>
</head>

<body>
  <div class="reveal">
    <div class="slides">
      <section class="center">
        <h1>Search the Docs</h1>
        <h3>Elastic Search at Read the Docs</h3>
        <p>
          <small>
            Santos Gallegos
            -
            @stsewd
            <a href="http://github.com/stsewd" target="_blank"><i class="fab fa-github"></i></a>
            <a href="http://twitter.com/stsewd" target="_blank"><i class="fab fa-twitter"></i></a>
          </small>
        </p>

        <br />

        <p class="gray">
          <i class="fas fa-keyboard"></i>
          Navigate with <kbd onclick="Reveal.next()">[ space ]</kbd>
        </p>
      </section>

      <section>
        <h2>$ whoami</h2>
        <ul>
          <li>Santos Gallegos</li>
          <li>Read the Docs</li>
          <li><i class="blue fab fa-python"></i> developer (web)</li>
          <li>@stsewd</li>
        </ul>
      </section>

      <section>
        <header style="align-items: center; display: flex; justify-content: center;">
          <img height="100px" src="img/rtd.png" style="margin: 0px;" />
          <h2>
            About Read the Docs
          </h2>
        </header>
        <ul>
          <li>Build and host your documentation</li>
          <li>
            Created around 2010
          </li>
          <li>More than 100K <i class="fab fa-osi"></i> projects</li>
          <li>Extra features</li>
          <li>
            <a href="https://readthedocs.org/" target="_blank">https://readthedocs.org/</a>
          </li>
        </ul>

        <p class="fragment">
          <img height="150px" src="img/rtd-footer.png" />
        </p>

        <aside class="notes">
          <ul>
            <li>
              A platform that allows you to built and host your documentation.
              Versioning, translations, sub-projects, and more!
            </li>
            <li>Created by Eric Holscher and others</li>
            <li>
              More than hundred thousand OS projects.
              Flask, tox, nox, pip, requests.
              https://pip.pypa.io/en/stable/
              https://www.sphinx-doc.org/en/master/
            </li>
            <li>
              If you are a python dev,
              chances are that you have already read docs hosted by rtd.
            </li>
            <li>
              Easy to recognize by this version selector to the bottom right of pages.
            </li>
          </ul>
        </aside>
      </section>

      <section>
        <h2>Server Side Search <i class="fas fa-search"></i></h2>
        <ul>
          <li>
            Better search experience
          </li>
          <li>
            Sphinx, MkDocs (partially)
          </li>
          <li>
            Search across sub-projects
          </li>
          <li>
            Ranking and ignoring pages
          </li>
          <li>
            Analytics
          </li>
          <li>
            API
          </li>
          <li>
            <code>"exact match"</code> <code>prefix*</code> <code>fuzzy~2</code>
          </li>
        </ul>

        <p>
          <br />
          <small>
            <i class="blue fas fa-link"></i>
          </small>
          <br />
          <small>
            <a href="https://docs.readthedocs.io/page/server-side-search.html"
              target="_blank">https://docs.readthedocs.io/page/server-side-search.html</a>
          </small>
        </p>

        <aside class="notes">
          <ul>
            <li>Better search experience inside and outside the docs pages</li>
            <li>MkDocs integration is still experimental, let us know if you want to test it in your project!</li>
            <li>rtd allows you to group several projects as sub-projects of another</li>
            <li>Allows you to give priority to some pages over others, or ignore them from results. This is like
              tweaking your own search engine!</li>
            <li>You can use server side search outside rtd via our API</li>
            <li>Simple query string syntax from ES</li>
          </ul>
        </aside>
      </section>

      <section>
        <h2><i class="fas fa-history"></i> A brief history about search at RTD</h2>
        <ul>
          <li class="fragment">
            <strong>2013</strong>
            Rob Hudson
            <a href="https://github.com/robhudson" target="_blank">@robhudson</a>
            (<a href="https://github.com/readthedocs/readthedocs.org/pull/493" target="_blank">#493</a>)
          </li>
          <li class="fragment">
            <strong>2018</strong>
            Safwan Rahman
            <a href="https://github.com/safwanrahman" target="_blank">@safwanrahman</a>
            <br />
            <small>
              <a href="https://blog.readthedocs.com/search-improvements/"
                target="_blank">https://blog.readthedocs.com/search-improvements/</a>
            </small>
          </li>
          <li class="fragment">
            <strong>2019</strong>
            Vaibhav Gupta
            <a href="https://github.com/dojutsu-user" target="_blank">@dojutsu-user</a>
            <br />
            <small>
              <a href="https://blog.readthedocs.com/improved-search-and-search-as-you-type/"
                target="_blank">https://blog.readthedocs.com/improved-search-and-search-as-you-type/</a>
            </small>
          </li>
          <li class="fragment">
            <strong>2020 - 2021</strong>
            Me!
          </li>
        </ul>

        <aside class="notes">
          <ul>
            <li>
              It was added around 2013, and improved from there.
              RTD was an small team (2 at the time), we still are (5 now!).
              It was working, so why touch it?
            </li>
            <li>
              Safwan participated as a Google summer of code student.
              Migrated ES from 1.3 (EOL 2016) to 6.x.
              Simple query string syntax support,
              improve results order,
              and added some management commands for re-indexing with zero-downtime.
              I joined the team that year!
            </li>
            <li>
              Vaibhav, another Google summer of code student.
              Search as you type extension.
              Results linking to specific sections.
              Search analytics.
              Helped a little with the migration to 7.x.
            </li>
            <li>
              Stable API.
              Improve the HTML parsing.
              Support for MkDocs.
              Ranking and ignore pages.
              Search on multiple projects.
            </li>
          </ul>
        </aside>
      </section>

      <section>
        <h2>Indexing Process <i class="far fa-file-code"></i></h2>
        <p class="fragment">Parse configuration file</p>
        <div class="fragment">
          <p>‚Üì</p>
          <p>Sphinx build ‚Üí JSON metadata &amp; HTML</p>
        </div>
        <div class="fragment">
          <p>‚Üì</p>
          <p>Track files with their ignore &amp; ranking options</p>
        </div>
        <div class="fragment">
          <p>‚Üì</p>
          <p>JSON metadata ‚Üí Searchable text</p>
        </div>

        <aside class="notes">
          <ul>
            <li>
              Parse the configuration file
              that has all the information to build your docs
              (and also search options!).
            </li>
            <li>
              Sphinx build,
              which generates all html pages from sources.
              We install an extension hook into the process and dump some meta-information
              about each page (title, main html content).
              We also inject our embedded script to patch the search engine from Sphinx.
              <a href="http://www.url.com" target="_blank">https://github.com/readthedocs/readthedocs-sphinx-ext</a>
            </li>
            <li>
              Go through each html file and save it on our DB and set the given ranking and set it as ignored or not.
            </li>
            <li>
              In a later step we go again over each html file,
              and retrieve the json metadata file,
              and extract its html.
              We parse the html to extract the searchable text and index it into ES.
            </li>
            <li>
              For MkDocs the process is almost the same,
              but we don't use an extension to get the main content,
              but instead we parse the search index or each html file.
              We'll see more about this later.
            </li>
          </ul>
        </aside>
      </section>

      <section>
        <h2>Configuration File</h2>

        <p>
          <em>.readthedocs.yaml</em>
        </p>

        <section>
          <pre><code class="hlyaml" data-trim>
                version: 2
                sphinx:
                  configuration: docs/conf.py
                python:
                  version: 3.8
                  install:
                    - requirements: docs/requirements.txt

                search:
                  ranking:
                    api/v1/*: -5
                    api/v2/*: 5
                  ignore:
                    - search.html
                    - 404.html
          </code></pre>
          <p>
            <br />
            <small>
              <i class="blue fas fa-link"></i>
            </small>
            <br />
            <small>
              <a href="https://docs.readthedocs.io/page/config-file/v2.html"
                target="_blank">https://docs.readthedocs.io/page/config-file/v2.html</a>
            </small>
          </p>

          <aside class="notes">
            <p>This is how a config file looks like for a sphinx project, we'll be focusing on the search part.</p>
          </aside>
        </section>

        <section>
          <pre><code class="hlyaml" data-trim>
                search:
                  ranking:
                    api/v1/*: -5
                    api/v2/*: 5
                  ignore:
                    - search.html
                    - 404.html
          </code></pre>

          <p>
            <br />
            <small>
              <i class="blue fas fa-link"></i>
            </small>
            <br />
            <small>
              <a href="https://docs.readthedocs.io/page/config-file/v2.html#search" target="_blank">
                https://docs.readthedocs.io/en/stable/config-file/v2.html#search
              </a>
            </small>
          </p>

          <aside class="notes">
            <ul>
              <li>Ranking is a map of a pattern to a ranking [-10, 10]. 0 means normal, not ignore.</li>
              <li>Ignore is a list of patterns</li>
            </ul>
          </aside>
        </section>
      </section>

      <section>
        <h2>Indexing the content</h2>
        <section>
          <ul>
            <li>Get metadata from each file or the file itself</li>
            <li>Extract searchable content based on heuristics</li>
            <li>Remove navigation nodes and line numbers from code-blocks</li>
            <li>Divide content into sections and domains (Sphinx)</li>
          </ul>

          <p>
            <br />
            <small>
              <i class="blue fas fa-link"></i>
            </small>
            <br />
            <small>
              <a href="https://github.com/readthedocs/readthedocs.org/blob/master/readthedocs/search/parsers.py"
                target="_blank">
                readthedocs/search/parsers.py
              </a>
            </small>
            <br />
            <small>
              <a href="https://github.com/readthedocs/readthedocs.org/blob/master/readthedocs/search/documents.py"
                target="_blank">readthedocs/search/documents.py</a>
            </small>
            <br />
            <small>
              <a href="https://docs.readthedocs.io/page/development/search-integration.html"
                target="_blank">https://docs.readthedocs.io/page/development/search-integration.html</a>
            </small>
          </p>

          <aside class="notes">
            <ul>
              <li>
                For sphinx we use the json metadata file.
                Show an example from search/tests/data/sphinx/in/page.json.
              </li>
              <li>
                For MkDocs we are testing two ways: using a search index file and indexing from HTML files.
                Show an example from search/tests/data/mkdocs/.
              </li>
              <li>
                We extract the searchable content based on some heuristics like aria roles (from accessibility) and html
                tags (semantic web!).
                Identify the main node of the content, remove irrelevant content like navigation items.
              </li>
              <li>
                Remove line numbers from code blocks, again this is done based on heuristics like the common way of
                representing code-blocks with numbers.
              </li>
              <li>
                Domains are specific of Sphinx, sphinx domains,
                like documentation extracted from source code.
              </li>
            </ul>
          </aside>
        </section>

        <section>
          <em>Identifying the main content node</em>
          <a href="img/parse-main-node.png" target="_blank">
            <img src="img/parse-main-node.png" alt="">
          </a>
        </section>

        <section>
          <em>Removing navigation nodes</em>
          <a href="img/parse-remove-nav-nodes.png" target="_blank">
            <img src="img/parse-remove-nav-nodes.png" alt="">
          </a>
        </section>

        <section>
          <em>Removing navigation nodes</em>
          <a href="img/parse-remove-permalinks.png" target="_blank">
            <img src="img/parse-remove-permalinks.png" alt="">
          </a>
        </section>

        <section>
          <em>Identifying sections</em>
          <a href="img/parse-sections.png" target="_blank">
            <img src="img/parse-sections.png" alt="">
          </a>
        </section>

        <section>
          <em>Identifying nested sections</em>
          <a href="img/parse-nested-sections.png" target="_blank">
            <img src="img/parse-nested-sections.png" alt="">
          </a>
        </section>
      </section>

      <section class="center">
        <h2>Ignoring pages</h2>
        <p>
          Ignored page ‚Üí not indexed page
          <i class="gray fas fa-check-double"></i>
        </p>

        <aside class="notes">
          This is simple,
          if the page is ignored we don't index it.
        </aside>
      </section>

      <section>
        <h2><i class="fas fa-sort-numeric-down"></i> Ranking pages</h2>
        <section>
          <ul>
            <li>Ranking can be done at index or search time</li>
            <li>
              Ranking at search time with
              <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-function-score-query.html"
                target="_blank">function score query</a>
            </li>
            <li>
              Painless script
            </li>
            <li>
              Map each ranking [-10, 10] to a score
            </li>
            <li>
              Play nice with custom boosting
            </li>
          </ul>
          <p>
            <br />
            <small>
              <i class="blue fas fa-link"></i>
            </small>
            <br />
            <small>
              <a href="https://github.com/readthedocs/readthedocs.org/blob/master/readthedocs/search/faceted_search.py"
                target="_blank">readthedocs/search/faceted_search.py</a>
            </small>
          </p>

          <aside class="notes">
            <ul>
              <li>
                Ranking can be done at index (boosting, specific fields) or search time,
                they have their pros ans cons.
                Faster queries, need re-index when the ranking value changes.
                For our case at search time was more appropriate.
              </li>
              <li>
                At search time with a function score query + script score.
                This is done with the painless scripting language.
              </li>
              <li>
                We map each ranking to a ES score,
                keeping in mind to still show relevant results
                independently from the ranking.
              </li>
            </ul>
          </aside>
        </section>

        <section>
          <em>Config file used at RTD</em>
          <pre><code class="hlyaml" data-trim>
          search:
            ignore:
              # Internal documentation
              - development/design/*
              - search.html
              - 404.html
           ranking:
              # Deprecated content
              api/v1.html: -1
              config-file/v1.html: -1
          
              # Useful content, but not something we want most users finding
              custom_installs/*: -6
              changelog.html: -6
          </code></pre>
        </section>

        <section>
          <em>Ignoring pages from results</em>
          <a href="img/search-ignoring-pages.png" target="_blank">
            <img src="img/search-ignoring-pages.png" alt="">
          </a>
        </section>

        <section>
          <em>Page with rank -6</em>
          <a href="img/search-lower-rank.png" target="_blank">
            <img src="img/search-lower-rank.png" alt="">
          </a>
        </section>

        <section>
          <em>Tie breaker with rank -1</em>
          <a href="img/search-rank-tie-breaker.png" target="_blank">
            <img src="img/search-rank-tie-breaker.png" alt="">
          </a>
        </section>

        <section>
          <p>
            <em>Painless script</em>
          </p>
          <pre><code class="hljava" data-trim>
            // ranking: [0.01, .. 0.8, 1, 1,3, .. 2]
            int rank =
              doc['rank'].size() == 0 ?
              0 : (int) doc['rank'].value;

            return params.ranking[rank + 10] * _score;
          </code></pre>
          <p>
            <br />
            <small>
              <i class="blue fas fa-link"></i>
            </small>
            <br />
            <small>
              <a href="https://www.elastic.co/guide/en/elasticsearch/reference/master/modules-scripting-painless.html"
                target="_blank">https://www.elastic.co/guide/en/elasticsearch/reference/master/modules-scripting-painless.html</a>
            </small>
          </p>

          <aside class="notes">
            <ul>
              <li>
                This is how a painless script looks like.
                It's almost like java,
                so if you aren't familiar with java o haven't coded in java in a long time (like myself!),
                it may not be that painless to code in...
              </li>
              <li>
                0.8 and 1.3 are magic numbers! They were calculated in base to our boosting values (2.0, 1.5).
                We return the final score by multiplying it with the ranking.
              </li>
            </ul>
          </aside>
        </section>
      </section>

      <section>
        <h2>Overriding the default search</h2>
        <section>
          <ul>
            <li>Hijack the search call via Javascript</li>
            <li>Keep a reference to the old search for backup</li>
          </ul>

          <p>
            <br />
            <small>
              <i class="blue fas fa-link"></i>
            </small>
            <br />
            <small>
              <a href="https://docs.readthedocs.io/page/development/search-integration.html#overriding-the-default-search"
                target="_blank">https://docs.readthedocs.io/page/development/search-integration.html#overriding-the-default-search</a>
            </small>
          </p>

          <aside class="notes">
            <ul>
              <li>
                We inject a script in all docs pages,
                part of what this script does is hijack the default search,
                so we use our SSS via our API.
              </li>
              <li>
                We still need to keep a reference to the original search
                as backup in case our api is down or in case our search
                doesn't return results.
              </li>
            </ul>
          </aside>
        </section>

        <section>

          <pre><code class="hljs" data-trim>
          var original_search = Search.query;

          function search_override(query) {
            var results = fetch_resuls(query);
            if (results) {
                for (var i = 0; i &le; results.length; i += 1) {
                  var result = process_result(results[i]);
                  Search.output.append(result);
                }
            } else {
                original_search(query);
            }
          }

          Search.query = search_override;

          $(document).ready(function() {
            Search.init();
          });
          </code></pre>
        </section>
      </section>

      <section>
        <h2>API</h2>
        <ul>
          <li>DRF wrapper around the ES response</li>
          <li>
            Serializers &amp; Pagination
          </li>
        </ul>

        <p>
          <a href="https://docs.readthedocs.io/_/api/v2/search/?project=docs&version=latest&q=api" target="_blank">
            docs.readthedocs.io/_/api/v2/search/?project=docs&version=latest&q=api
          </a>
        </p>

        <p>
          <br />
          <small>
            <i class="blue fas fa-link"></i>
          </small>
          <br />
          <small>
            <a href="https://github.com/readthedocs/readthedocs.org/blob/master/readthedocs/search/api.py"
              target="_blank">readthedocs/search/api.py</a>
          </small>
          <br />
          <small>
            <a href="https://docs.readthedocs.io/page/server-side-search.html#api" target="_blank">
              https://docs.readthedocs.io/page/server-side-search.html#api
            </a>
          </small>
        </p>

        <aside class="notes">
          <ul>
            <li>We used to return the same response from ES, but it can break compatibility</li>
            <li>
              Show off with page_size=10
            </li>
          </ul>
        </aside>
      </section>

      <section class="center">
        <h1>Problems</h1>
        <small class="green fragment">And solutions!</small>
      </section>

      <section>
        <h2>Latency üêå</h2>

        <ul>
          <li>
            <s>ES cloud (AWS) ‚Üí RTD app (Azure)</s>
          </li>
          <li>
            ES cloud (Azure) ‚Üí RTD app (Azure)
          </li>
        </ul>

        <ul class="fragment">
          <li>
            <s>ES cloud (AWS zone B) ‚Üí RTD app (AWS zone A)</s>
          </li>
          <li>
            ES cloud (AWS zone A) ‚Üí RTD app (AWS zone A)
          </li>
        </ul>

        <aside class="notes">
          <ul>
            <li>
              Our API response was very slow.
            </li>
            <li>Elastic Cloud let's you choose were to host your ES instance</li>
            <li>
              .org was on azure, and ES was hosted on aws.
              We have now migrated to AWS, so we migrated ES again to aws.
            </li>
            <li>
              .com is on aws, ES was aws... But on a different zone!
            </li>
            <li>
              In conclusion, make sure your ES deploy in on the same cloud provider and zone to improve latency.
            </li>
          </ul>
        </aside>
      </section>

      <section>
        <h2>
          Partial terms results
        </h2>
        <section>
          <ul>
            <li>Search for code and words</li>
            <li class="fragment">
              <span class="red">theme</span>,
              <span class="red">theme</span>s,
              t<span class="red">e</span>mes,
              temes<span class="red">~1</span>
            </li>
            <li class="fragment">
              python<span class="red">.*</span>,
              <span class="red">*.</span>fail_on_warning
            </li>
            <li class="fragment">
              <span class="red">test</span>,
              <span class="red">test</span>ing
            </li>
            <li class="fragment">
              <span class="red">index</span>,
              re<span class="red">index</span>,
              <span class="red">index</span>ing,
              re<span class="red">index</span>ing
            </li>
          </ul>

          <aside class="notes">
            <ul>
              <li>We host technical documentation, so users search for code and words!</li>
              <li>Code is different from words, punctuation isn't mean to separate "words" in code</li>
              <li>What I mean with partial terms? Let's look at the examples</li>
              <li>Search for theme, themes, then with typo (we won't be using ~ too much, we don't know we have a typo!)
              </li>
              <li>Explicit suffix search, but explicit prefix search isn't supported</li>
              <li>Implicit suffix search</li>
              <li>Implicit suffix and prefix search</li>
            </ul>
          </aside>
        </section>

        <section>
          <ul>
            <li>
              <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-simple-query-string-query.html"
                target="_blank">
                Simple query string query
              </a>
            </li>
            <li>
              <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/common-options.html#fuzziness"
                target="_blank">
                Multi-match query (fuzziness AUTO:4,6)
              </a>
            </li>
            <li>
              <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-wildcard-query.html"
                target="_blank">
                Wildcard query
              </a>
            </li>
            <li>
              We can combine multiple types of queries,
              but we don't always want to combine them all.
            </li>
            <li>
              Single/simple search terms vs complex terms.
            </li>
          </ul>

          <p>
            <br />
            <small>
              <i class="blue fas fa-link"></i>
            </small>
            <br />
            <small>
              <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/full-text-queries.html"
                target="_blank">https://www.elastic.co/guide/en/elasticsearch/reference/current/full-text-queries.html</a>
            </small>
          </p>
          <aside class="notes">
            <ul>
              <li>Simple query string is useful when we know what we are looking for (refine our search)</li>
              <li>
                Fuzzy search is useful when we don't know what we are looking for
                (or we don't know how to write it, specially if the isn't your lang)
              </li>
              <li>
                Wildcard queries support prefix and suffix searches!
              </li>
              <li>
                We can combine several type of searches in one
              </li>
              <li>
                But how to we know when to use one or combine several?
              </li>
              <li>
                Again, more heuristics to find out!
                Simple search terms don't have the special syntax,
                and have just one word.
              </li>
              <li>
                Maybe we could add the string length to the heuristics?
              </li>
            </ul>
          </aside>
        </section>

        <section>
          <ul style="list-style: none;">
            <li><i class="red fas fa-times"></i> Wildcard queries over <strong>Text fields</strong> can be slow...</li>
            <li class="fragment"><i class="green fas fa-check"></i> Wildcard queries over <strong>Wildcard
                fields</strong> are fast!</li>
            <li class="fragment">
              <i class="red fas fa-times"></i>
              Wildcard or Text field?...
            </li>
            <li class="fragment">
              <i class="green fas fa-check"></i>
              Both! Multi fields
              (<a href="https://github.com/readthedocs/readthedocs.org/pull/7613" target="_blank">#7613</a>)
            </li>
          </ul>
          <p>
            <br />
            <small>
              <i class="blue fas fa-link"></i>
            </small>
            <br />
            <small>
              <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/keyword.html#wildcard-field-type"
                target="_blank">https://www.elastic.co/guide/en/elasticsearch/reference/current/keyword.html#wildcard-field-type</a>
            </small>
          </p>

          <aside class="notes">
            <ul>
              <li>
                Bad news, the docs mention that wildcard queries over text fields can be slow,
                but maybe they aren't that bad... Let's try it!
                502!
              </li>
              <li>
                Good news, we have wildcard fields!
              </li>
              <li>
                Bad news!
                They are indexed in a different way,
                we need to decide between each other!
                We still want to have the other type of searches (break between words)!
                (we haven't deployed this solution yet)
              </li>
              <li>
                On .com there wasn't any downside in performance.
                There we have a smaller index.
              </li>
            </ul>
          </aside>
        </section>
      </section>

      <section>
        <h2>Other things</h2>

        <ul>
          <li>
            Sponsored account of Elastic Cloud <i class="red fas fa-heart"></i>
          </li>
          <li>
            Cached results via Cloudflare
            <i class="orange fab fa-cloudflare"></i>
          </li>
          <li>
            Search as you type
            <br />
            <small>
              <a href="https://readthedocs-sphinx-search.readthedocs.io/"
                target="_blank">https://readthedocs-sphinx-search.readthedocs.io/</a>
            </small>
          </li>
        </ul>

        <aside class="notes">
          <ul>
            <li>Thank you very much Elastic!</li>
            <li>If you (or anyone else) search the same term, you'll get a cached response</li>
            <li>The contents is static, so caching is fine, we also purge the cache when a new build happens</li>
          </ul>
        </aside>
      </section>

      <section>
        <h2>What's next?</h2>
        <ul>
          <li>
            Better results for partial terms
            <a href="https://github.com/readthedocs/readthedocs.org/pull/7613" target="_blank">#7613</a>
          </li>
          <li>
            Weight page views into results
            <a href="https://github.com/readthedocs/readthedocs.org/pull/7297" target="_blank">#7297</a>
          </li>
          <li>
            Use SSS by default for MkDocs
          </li>
          <li class="gray">Enable search indexing for pull requests previews?</li>
          <li class="gray">Ignore and ranking per sections?</li>
          <li class="gray">
            Better display for results from code blocks?
            <a href="https://github.com/readthedocs/readthedocs.org/pull/7112" target="_blank">#7112</a>
          </li>
          <li class="gray">Search for images and code snippets?</li>
          <li class="gray">Search by files patterns and other facets?</li>
        </ul>

        <aside class="notes">
          Gray items are still pending on decisions or are just ideas,
          so they may not be implemented soon or ever.
        </aside>
      </section>

      <section class="center">
        <h3>Search the Docs with Read the Docs and Elastic Search</h3>
        <footer class="footer">
          <p>
            <small class="text-center">
              <a href="https://stsewd.dev/">
                <span>
                  More about me
                </span>
                <br />
                <span>https://stsewd.dev/</span>
              </a>
            </small>
          </p>

          <p>
            <small class="text-center">
              <a href="https://github.com/stsewd/talk-search-the-docs/">
                <span>
                  Source code at GitHub <i class="fas fa-code-branch"></i>
                </span>
                <br />
                <span>https://github.com/stsewd/talk-search-the-docs/</span>
              </a>
            </small>
          </p>

          <p>
            <small>
              @stsewd
              <a href="http://github.com/stsewd"><i class="fab fa-github"></i></a>
              <a href="http://twitter.com/stsewd"><i class="fab fa-twitter"></i></a>
            </small>
          </p>
        </footer>

        <aside class="notes">
        </aside>
      </section>
    </div>
  </div>

  <script src="dist/reveal.js"></script>
  <script src="plugin/notes/notes.js"></script>
  <script src="plugin/markdown/markdown.js"></script>
  <script src="plugin/highlight/highlight.js"></script>
  <script>
    // More info about initialization & config:
    // - https://revealjs.com/initialization/
    // - https://revealjs.com/config/
    Reveal.initialize({
      hash: true,
      center: false,
      maxScale: 0.7,

      // Learn about plugins: https://revealjs.com/plugins/
      plugins: [RevealMarkdown, RevealHighlight, RevealNotes]
    });
  </script>
</body>

</html>
